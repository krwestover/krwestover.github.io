<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Snake Game</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
        background-color: black;
        color: white;
      }
      #game-container {
        position: relative;
        border: 1px solid #4a5568;
        border-radius: 0.5rem;
        overflow: hidden;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }
      #game-board {
        background: linear-gradient(135deg, #1a202c, #2d3748);
      }
      .snake-segment {
        position: absolute;
        background-color: #48bb78;
        border-radius: 0.125rem;
        box-shadow: 0 2px 4px rgba(0, 255, 0, 0.3);
        transition: all 0.1s linear;
      }
      .apple {
        position: absolute;
        background-color: #f56565;
        border-radius: 50%;
        box-shadow: 0 2px 4px rgba(255, 0, 0, 0.3);
        transition: all 0.1s linear;
      }
      .overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: rgba(0, 0, 0, 0.7);
      }
      .message {
        background-color: #ecc94b;
        color: black;
        font-weight: bold;
        padding: 0.5rem 1rem;
        border-radius: 9999px;
        display: flex;
        align-items: center;
      }
      .heart {
        color: #f56565;
        margin-right: 0.25rem;
      }
      button {
        margin-top: 1rem;
        background-color: #48bb78;
        color: white;
        font-weight: bold;
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 0.25rem;
        cursor: pointer;
      }
      button:hover {
        background-color: #38a169;
      }
      .stoplight {
        display: flex;
        margin-bottom: 0.5rem;
      }
      .stoplight-light {
        width: 1rem;
        height: 1rem;
        border-radius: 50%;
        margin-right: 0.25rem;
      }
    </style>
  </head>
  <body>
    <div id="score"></div>
    <div id="lives"></div>
    <div id="auto-play"></div>
    <div id="stoplight" class="stoplight"></div>
    <div id="game-container">
      <canvas id="game-board"></canvas>
      <div id="overlay" class="overlay" style="display: none">
        <div id="message" class="message"></div>
      </div>
    </div>
    <button id="start-button">Start Game</button>

    <script>
      const GRID_SIZE = 20;
      const CELL_SIZE = 20;
      const INITIAL_SNAKE = [{ x: 10, y: 10 }];
      const INITIAL_DIRECTION = { x: 1, y: 0 };
      const INITIAL_APPLE = { x: 10, y: 10 };
      const INITIAL_LIVES = 3;

      let snake = [...INITIAL_SNAKE];
      let direction = { ...INITIAL_DIRECTION };
      let apple = { ...INITIAL_APPLE };
      let score = 0;
      let lives = INITIAL_LIVES;
      let gameOver = false;
      let isWinner = false;
      let goalApples = 10;
      let gameStarted = false;
      let autoPlay = false;
      let resurrecting = false;
      let stoplightColor = "red";

      const gameBoard = document.getElementById("game-board");
      const ctx = gameBoard.getContext("2d");
      const scoreElement = document.getElementById("score");
      const livesElement = document.getElementById("lives");
      const autoPlayElement = document.getElementById("auto-play");
      const stoplightElement = document.getElementById("stoplight");
      const overlay = document.getElementById("overlay");
      const message = document.getElementById("message");
      const startButton = document.getElementById("start-button");

      gameBoard.width = GRID_SIZE * CELL_SIZE;
      gameBoard.height = GRID_SIZE * CELL_SIZE;

      function resetGame() {
        snake = [...INITIAL_SNAKE];
        direction = { ...INITIAL_DIRECTION };
        apple = { ...INITIAL_APPLE };
        score = 0;
        lives = INITIAL_LIVES;
        gameOver = false;
        isWinner = false;
        gameStarted = true;
        autoPlay = false;
        resurrecting = false;
        overlay.style.display = "none";
      }

      function placeApple() {
        do {
          apple = {
            x: Math.floor(Math.random() * GRID_SIZE),
            y: Math.floor(Math.random() * GRID_SIZE),
          };
        } while (
          snake.some(
            (segment) => segment.x === apple.x && segment.y === apple.y
          )
        );
      }

      function isValidMove(x, y) {
        return (
          x >= 0 &&
          x < GRID_SIZE &&
          y >= 0 &&
          y < GRID_SIZE &&
          !snake.some((segment) => segment.x === x && segment.y === y)
        );
      }

      function findPath(head, target) {
        const queue = [[head.x, head.y]];
        const visited = new Set();
        const parent = new Map();

        while (queue.length > 0) {
          const [x, y] = queue.shift();
          const key = `${x},${y}`;

          if (x === target.x && y === target.y) {
            const path = [];
            let current = key;
            while (current) {
              const [cx, cy] = current.split(",").map(Number);
              path.unshift([cx, cy]);
              current = parent.get(current);
            }
            return path;
          }

          if (!visited.has(key)) {
            visited.add(key);
            [
              [0, -1],
              [0, 1],
              [-1, 0],
              [1, 0],
            ].forEach(([dx, dy]) => {
              const newX = x + dx;
              const newY = y + dy;
              const newKey = `${newX},${newY}`;
              if (isValidMove(newX, newY) && !visited.has(newKey)) {
                queue.push([newX, newY]);
                parent.set(newKey, key);
              }
            });
          }
        }

        return null;
      }

      function moveSnake() {
        if (gameOver || isWinner || resurrecting) return;

        const head = { ...snake[0] };

        if (autoPlay) {
          const path = findPath(head, apple);
          if (path && path.length > 1) {
            [head.x, head.y] = path[1];
          } else {
            const safeMoves = [
              [0, -1],
              [0, 1],
              [-1, 0],
              [1, 0],
            ].filter(([dx, dy]) => isValidMove(head.x + dx, head.y + dy));
            if (safeMoves.length > 0) {
              const [dx, dy] =
                safeMoves[Math.floor(Math.random() * safeMoves.length)];
              head.x += dx;
              head.y += dy;
            } else {
              handleCollision();
              return;
            }
          }
        } else {
          head.x += direction.x;
          head.y += direction.y;
        }

        if (
          head.x < 0 ||
          head.x >= GRID_SIZE ||
          head.y < 0 ||
          head.y >= GRID_SIZE ||
          snake.some((segment) => segment.x === head.x && segment.y === head.y)
        ) {
          handleCollision();
          return;
        }

        snake.unshift(head);

        if (head.x === apple.x && head.y === apple.y) {
          score++;
          if (score >= goalApples) {
            isWinner = true;
          }
          placeApple();
        } else {
          snake.pop();
        }

        updateGame();
      }

      function handleCollision() {
        lives--;
        if (lives > 0) {
          resurrecting = true;
          startStoplightTimer();
        } else {
          gameOver = true;
        }
        updateGame();
      }

      function startStoplightTimer() {
        stoplightColor = "red";
        updateStoplight();
        setTimeout(() => {
          stoplightColor = "yellow";
          updateStoplight();
          setTimeout(() => {
            stoplightColor = "green";
            updateStoplight();
            setTimeout(() => {
              resurrecting = false;
              snake = [...INITIAL_SNAKE];
              direction = { ...INITIAL_DIRECTION };
              updateGame();
            }, 1000);
          }, 1000);
        }, 1000);
      }

      function updateGame() {
        ctx.clearRect(0, 0, gameBoard.width, gameBoard.height);

        // Draw snake
        snake.forEach((segment, index) => {
          ctx.fillStyle = "#48bb78";
          ctx.fillRect(
            segment.x * CELL_SIZE,
            segment.y * CELL_SIZE,
            CELL_SIZE,
            CELL_SIZE
          );
        });

        // Draw apple
        ctx.fillStyle = "#f56565";
        ctx.beginPath();
        ctx.arc(
          (apple.x + 0.5) * CELL_SIZE,
          (apple.y + 0.5) * CELL_SIZE,
          CELL_SIZE / 2,
          0,
          2 * Math.PI
        );
        ctx.fill();

        scoreElement.textContent = `Score: ${score} / ${goalApples}`;
        livesElement.textContent = "‚ù§Ô∏è".repeat(lives);
        autoPlayElement.textContent = autoPlay ? "Auto-play activated!" : "";

        if (isWinner) {
          overlay.style.display = "flex";
          message.textContent = "üèÜ Winner!";
        } else if (gameOver) {
          overlay.style.display = "flex";
          message.textContent = "Game Over!";
        } else {
          overlay.style.display = "none";
        }
      }

      function updateStoplight() {
        stoplightElement.innerHTML = `
                <div class="stoplight-light" style="background-color: ${
                  stoplightColor === "red" ? "#f56565" : "#4a5568"
                }"></div>
                <div class="stoplight-light" style="background-color: ${
                  stoplightColor === "yellow" ? "#ecc94b" : "#4a5568"
                }"></div>
                <div class="stoplight-light" style="background-color: ${
                  stoplightColor === "green" ? "#48bb78" : "#4a5568"
                }"></div>
            `;
      }

      document.addEventListener("keydown", (e) => {
        if (!gameStarted || resurrecting) return;
        if (e.code === "Space") {
          autoPlay = !autoPlay;
          return;
        }
        if (autoPlay) return;

        switch (e.key) {
          case "ArrowUp":
            if (direction.y !== 1) direction = { x: 0, y: -1 };
            break;
          case "ArrowDown":
            if (direction.y !== -1) direction = { x: 0, y: 1 };
            break;
          case "ArrowLeft":
            if (direction.x !== 1) direction = { x: -1, y: 0 };
            break;
          case "ArrowRight":
            if (direction.x !== -1) direction = { x: 1, y: 0 };
            break;
        }
      });

      startButton.addEventListener("click", () => {
        resetGame();
        gameLoop = setInterval(moveSnake, 100);
        startButton.textContent = "Restart Game";
      });

      updateGame();
    </script>
  </body>
</html>
